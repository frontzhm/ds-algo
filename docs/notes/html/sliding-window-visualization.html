<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ»‘åŠ¨çª—å£å‰ªæå¯è§†åŒ– - åŠ¨æ€æ¼”ç¤º</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 10px;
        font-size: 2.5em;
      }

      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
        font-size: 1.1em;
      }

      .info-panel {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .info-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
      }

      .info-card h3 {
        font-size: 14px;
        opacity: 0.9;
        margin-bottom: 10px;
      }

      .info-card .value {
        font-size: 28px;
        font-weight: bold;
      }

      .info-card .label {
        font-size: 12px;
        opacity: 0.8;
        margin-top: 5px;
      }

      .matrix-container {
        overflow-x: auto;
        margin: 30px 0;
        background: #f8f9fa;
        padding: 20px;
        border-radius: 12px;
      }

      .matrix {
        border-collapse: collapse;
        margin: 0 auto;
        font-size: 14px;
      }

      .matrix th,
      .matrix td {
        padding: 8px 12px;
        text-align: center;
        border: 1px solid #ddd;
        min-width: 50px;
        position: relative;
      }

      .matrix th {
        background: #667eea;
        color: white;
        font-weight: bold;
      }

      .matrix td {
        background: white;
        transition: all 0.3s;
      }

      .matrix td.checked {
        background: #51cf66;
        color: white;
        font-weight: bold;
      }

      .matrix td.pruned {
        background: #ff6b6b;
        color: white;
        text-decoration: line-through;
        opacity: 0.7;
      }

      .matrix td.current {
        background: #ffd43b;
        color: #333;
        font-weight: bold;
        box-shadow: 0 0 10px rgba(255, 212, 59, 0.8);
        transform: scale(1.1);
        z-index: 10;
      }

      .matrix td.invalid {
        background: #e9ecef;
        color: #adb5bd;
      }

      .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin: 30px 0;
      }

      .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: bold;
      }

      .btn-primary {
        background: #667eea;
        color: white;
      }

      .btn-primary:hover {
        background: #5568d3;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #5a6268;
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .explanation {
        background: #e7f3ff;
        border-left: 4px solid #667eea;
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
      }

      .explanation h3 {
        color: #667eea;
        margin-bottom: 10px;
      }

      .explanation p {
        color: #333;
        line-height: 1.6;
        margin-bottom: 10px;
      }

      .pointer-info {
        display: flex;
        gap: 30px;
        justify-content: center;
        margin-bottom: 20px;
        font-size: 18px;
        flex-wrap: wrap;
      }

      .pointer-info span {
        padding: 10px 20px;
        background: #f0f0f0;
        border-radius: 8px;
        font-weight: bold;
      }

      .pointer-info .left {
        color: #51cf66;
      }

      .pointer-info .right {
        color: #ff6b6b;
      }

      .step-counter {
        text-align: center;
        font-size: 18px;
        color: #666;
        margin-bottom: 20px;
      }

      .window-display {
        text-align: center;
        margin: 20px 0;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        font-size: 18px;
      }

      .window-display .window {
        font-family: 'Courier New', monospace;
        background: white;
        padding: 10px 20px;
        border-radius: 6px;
        display: inline-block;
        margin: 0 10px;
        border: 2px solid #667eea;
      }

      .window-display .has-duplicate {
        border-color: #ff6b6b;
        background: #ffe0e0;
      }

      .window-display .no-duplicate {
        border-color: #51cf66;
        background: #e0ffe0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸªŸ æ»‘åŠ¨çª—å£å‰ªæå¯è§†åŒ–</h1>
      <p class="subtitle">åŠ¨æ€æ¼”ç¤ºï¼šä» O(nÂ²) ä¼˜åŒ–åˆ° O(n) çš„å‰ªæè¿‡ç¨‹ - æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</p>

      <div class="info-panel">
        <div class="info-card">
          <h3>åˆå§‹ç»„åˆæ•°</h3>
          <div class="value" id="totalCombinations">0</div>
          <div class="label">O(nÂ²)</div>
        </div>
        <div class="info-card">
          <h3>å‰©ä½™ç»„åˆæ•°</h3>
          <div class="value" id="remainingCombinations">0</div>
          <div class="label" id="remainingLabel">å¾…æ£€æŸ¥</div>
        </div>
        <div class="info-card">
          <h3>å·²æ£€æŸ¥ç»„åˆ</h3>
          <div class="value" id="checkedCombinations">0</div>
          <div class="label">å½“å‰è¿›åº¦</div>
        </div>
        <div class="info-card">
          <h3>å·²å‰ªæç»„åˆ</h3>
          <div class="value" id="prunedCombinations">0</div>
          <div class="label">è¢«å‰ªæ‰</div>
        </div>
        <div class="info-card">
          <h3>æ—¶é—´å¤æ‚åº¦</h3>
          <div class="value" id="timeComplexity">O(nÂ²)</div>
          <div class="label" id="timeLabel">ä¼˜åŒ–ä¸­...</div>
        </div>
      </div>

      <div class="step-counter">
        <span>æ­¥éª¤ï¼š<strong id="stepCount">0</strong></span>
      </div>

      <div class="pointer-info">
        <span class="left">å·¦æŒ‡é’ˆ (left): <strong id="leftPointer">0</strong></span>
        <span class="right">å³æŒ‡é’ˆ (right): <strong id="rightPointer">0</strong></span>
      </div>

      <div class="window-display">
        <span>å½“å‰çª—å£ï¼š</span>
        <span class="window" id="windowDisplay">-</span>
        <span id="windowStatus"></span>
      </div>

      <div class="matrix-container">
        <table class="matrix" id="matrix"></table>
      </div>

      <div class="controls">
        <button class="btn btn-primary" onclick="nextStep()">ä¸‹ä¸€æ­¥ â–¶</button>
        <button class="btn btn-secondary" onclick="reset()">é‡ç½® ğŸ”„</button>
        <button class="btn btn-secondary" onclick="autoPlay()">è‡ªåŠ¨æ’­æ”¾ â¯</button>
      </div>

      <div class="explanation" id="explanation">
        <h3>ğŸ’¡ è¯´æ˜</h3>
        <p id="explanationText">ç‚¹å‡»"ä¸‹ä¸€æ­¥"å¼€å§‹æ¼”ç¤ºæ»‘åŠ¨çª—å£çš„å‰ªæè¿‡ç¨‹</p>
      </div>
    </div>

    <script>
      let state = {
        left: 0,
        right: 0,
        step: 0,
        checked: new Set(), // å·²æ£€æŸ¥çš„ç»„åˆ
        pruned: new Set(), // è¢«å‰ªæ‰çš„ç»„åˆ
        data: 'abcabcbb', // å­—ç¬¦ä¸²æ•°æ®
        autoPlayInterval: null,
      };

      // åˆå§‹åŒ–çŸ©é˜µ
      function initMatrix() {
        const matrix = document.getElementById('matrix');
        matrix.innerHTML = '';
        const n = state.data.length;

        // åˆ›å»ºè¡¨å¤´
        const headerRow = document.createElement('tr');
        const emptyCell = document.createElement('th');
        headerRow.appendChild(emptyCell);
        for (let j = 0; j < n; j++) {
          const th = document.createElement('th');
          th.textContent = j;
          headerRow.appendChild(th);
        }
        matrix.appendChild(headerRow);

        // åˆ›å»ºæ•°æ®è¡Œ
        for (let i = 0; i < n; i++) {
          const row = document.createElement('tr');
          const rowHeader = document.createElement('th');
          rowHeader.textContent = i;
          row.appendChild(rowHeader);

          for (let j = 0; j < n; j++) {
            const cell = document.createElement('td');
            if (i > j) {
              cell.textContent = '-';
              cell.classList.add('invalid');
            } else {
              const key = `${i},${j}`;
              cell.textContent = key;
              cell.id = `cell-${i}-${j}`;
            }
            row.appendChild(cell);
          }
          matrix.appendChild(row);
        }

        updateStats();
      }

      // æ£€æŸ¥çª—å£æ˜¯å¦æœ‰é‡å¤å­—ç¬¦
      function hasDuplicate(left, right) {
        const window = state.data.slice(left, right + 1);
        const chars = new Set();
        for (let char of window) {
          if (chars.has(char)) {
            return true;
          }
          chars.add(char);
        }
        return false;
      }

      // è·å–çª—å£å­—ç¬¦ä¸²
      function getWindowString(left, right) {
        return state.data.slice(left, right + 1);
      }

      // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
      function updateStats() {
        const n = state.data.length;
        const total = (n * (n + 1)) / 2;
        const checked = state.checked.size;
        const pruned = state.pruned.size;
        const remaining = total - checked - pruned;

        document.getElementById('totalCombinations').textContent = total;
        document.getElementById('checkedCombinations').textContent = checked;
        document.getElementById('prunedCombinations').textContent = pruned;
        document.getElementById('remainingCombinations').textContent = remaining;

        // æ›´æ–°æ—¶é—´å¤æ‚åº¦æ˜¾ç¤º
        const timeComplexity = document.getElementById('timeComplexity');
        const timeLabel = document.getElementById('timeLabel');
        if (remaining <= n) {
          timeComplexity.textContent = 'O(n)';
          timeLabel.textContent = 'ä¼˜åŒ–å®Œæˆï¼';
          timeComplexity.style.color = '#51cf66';
        } else {
          timeComplexity.textContent = 'O(nÂ²)';
          timeLabel.textContent = 'ä¼˜åŒ–ä¸­...';
          timeComplexity.style.color = '#ff6b6b';
        }
      }

      // æ›´æ–°çŸ©é˜µæ˜¾ç¤º
      function updateMatrix() {
        const n = state.data.length;

        // æ¸…é™¤æ‰€æœ‰é«˜äº®
        for (let i = 0; i < n; i++) {
          for (let j = 0; j < n; j++) {
            if (i <= j) {
              const cell = document.getElementById(`cell-${i}-${j}`);
              if (cell) {
                cell.classList.remove('checked', 'pruned', 'current');
              }
            }
          }
        }

        // æ ‡è®°å·²æ£€æŸ¥çš„ç»„åˆ
        state.checked.forEach(key => {
          const [i, j] = key.split(',').map(Number);
          const cell = document.getElementById(`cell-${i}-${j}`);
          if (cell) {
            cell.classList.add('checked');
          }
        });

        // æ ‡è®°è¢«å‰ªæ‰çš„ç»„åˆ
        state.pruned.forEach(key => {
          const [i, j] = key.split(',').map(Number);
          const cell = document.getElementById(`cell-${i}-${j}`);
          if (cell) {
            cell.classList.add('pruned');
          }
        });

        // é«˜äº®å½“å‰æ£€æŸ¥çš„ç»„åˆ
        if (state.left <= state.right) {
          const cell = document.getElementById(`cell-${state.left}-${state.right}`);
          if (cell) {
            cell.classList.add('current');
          }
        }
      }

      // æ›´æ–°çª—å£æ˜¾ç¤º
      function updateWindowDisplay() {
        const windowDisplay = document.getElementById('windowDisplay');
        const windowStatus = document.getElementById('windowStatus');
        const window = getWindowString(state.left, state.right);
        const duplicate = hasDuplicate(state.left, state.right);

        windowDisplay.textContent = window || '-';
        windowDisplay.className = 'window';
        if (window) {
          windowDisplay.classList.add(duplicate ? 'has-duplicate' : 'no-duplicate');
        }

        if (duplicate) {
          windowStatus.textContent = 'âŒ å­˜åœ¨é‡å¤å­—ç¬¦';
          windowStatus.style.color = '#ff6b6b';
        } else {
          windowStatus.textContent = 'âœ… æ— é‡å¤å­—ç¬¦';
          windowStatus.style.color = '#51cf66';
        }
      }

      // æ›´æ–°è¯´æ˜æ–‡å­—
      function updateExplanation() {
        const explanationText = document.getElementById('explanationText');
        const window = getWindowString(state.left, state.right);
        const duplicate = hasDuplicate(state.left, state.right);

        if (state.step === 0) {
          explanationText.textContent = 'ç‚¹å‡»"ä¸‹ä¸€æ­¥"å¼€å§‹æ¼”ç¤ºæ»‘åŠ¨çª—å£çš„å‰ªæè¿‡ç¨‹';
          return;
        }

        let text = `æ­¥éª¤ ${state.step}ï¼šå½“å‰æ£€æŸ¥çª—å£ [${state.left}, ${state.right}] = "${window}"\n\n`;

        if (duplicate) {
          text += `âŒ çª—å£å­˜åœ¨é‡å¤å­—ç¬¦ï¼Œéœ€è¦ç§»åŠ¨ left æŒ‡é’ˆç¼©å°çª—å£ã€‚\n\n`;
          text += `ğŸ“Š å‰ªææ•ˆæœï¼šç§»åŠ¨ left++ åï¼Œå°†å‰ªæ‰ç¬¬ ${state.left} è¡Œçš„æ‰€æœ‰å‰©ä½™ç»„åˆ `;
          text += `(${state.left}, ${state.right + 1}) åˆ° (${state.left}, ${state.data.length - 1})ã€‚\n\n`;
          text += `ğŸ’¡ åŸç†ï¼šå¦‚æœçª—å£ [${state.left}, ${state.right}] å­˜åœ¨é‡å¤å­—ç¬¦ï¼Œ`;
          text += `é‚£ä¹ˆæ‰€æœ‰åŒ…å«è¯¥çª—å£çš„æ›´å¤§çª—å£ [${state.left}, ${state.right + 1}]ã€[${state.left}, ${state.right + 2}]... å¿…ç„¶ä¹ŸåŒ…å«é‡å¤å­—ç¬¦ï¼Œæ— éœ€æ£€æŸ¥ã€‚`;
        } else {
          text += `âœ… çª—å£æ— é‡å¤å­—ç¬¦ï¼Œå¯ä»¥ç»§ç»­æ‰©å±• right æŒ‡é’ˆæ¢ç´¢æ›´é•¿çš„æœ‰æ•ˆçª—å£ã€‚\n\n`;
          text += `ğŸ“Š å½“å‰çª—å£æ˜¯æœ‰æ•ˆçš„ï¼Œè®°å½•é•¿åº¦ ${state.right - state.left + 1}ã€‚\n\n`;
          text += `ğŸ’¡ åŸç†ï¼šå¦‚æœçª—å£ [${state.left}, ${state.right}] æ— é‡å¤å­—ç¬¦ï¼Œ`;
          text += `é‚£ä¹ˆæ‰€æœ‰è¢«è¯¥çª—å£åŒ…å«çš„æ›´å°çª—å£ [${state.left + 1}, ${state.right}]ã€[${state.left + 2}, ${state.right}]... å¿…ç„¶ä¹Ÿæ— é‡å¤å­—ç¬¦ï¼Œä½†é•¿åº¦æ›´çŸ­ï¼Œä¸æ˜¯æœ€ä¼˜è§£ã€‚`;
        }

        explanationText.textContent = text;
      }

      // æ‰§è¡Œä¸‹ä¸€æ­¥
      function nextStep() {
        const n = state.data.length;

        // å¦‚æœ right å·²ç»åˆ°è¾¾æœ«å°¾ï¼Œç»“æŸ
        if (state.right >= n) {
          document.getElementById('explanationText').textContent =
            'âœ… æ¼”ç¤ºå®Œæˆï¼æ‰€æœ‰æœ‰æ•ˆç»„åˆå·²æ£€æŸ¥å®Œæ¯•ã€‚';
          return;
        }

        state.step++;

        // æ£€æŸ¥å½“å‰çª—å£
        const duplicate = hasDuplicate(state.left, state.right);
        const key = `${state.left},${state.right}`;
        state.checked.add(key);

        if (duplicate) {
          // å­˜åœ¨é‡å¤å­—ç¬¦ï¼Œç§»åŠ¨ left æŒ‡é’ˆï¼Œå‰ªæ‰ç¬¬ left è¡Œçš„æ‰€æœ‰å‰©ä½™ç»„åˆ
          for (let j = state.right + 1; j < n; j++) {
            const pruneKey = `${state.left},${j}`;
            if (!state.checked.has(pruneKey)) {
              state.pruned.add(pruneKey);
            }
          }
          state.left++;
        } else {
          // æ— é‡å¤å­—ç¬¦ï¼Œç»§ç»­æ‰©å±• right æŒ‡é’ˆ
          state.right++;
        }

        // æ›´æ–°æ˜¾ç¤º
        document.getElementById('leftPointer').textContent = state.left;
        document.getElementById('rightPointer').textContent = state.right;
        document.getElementById('stepCount').textContent = state.step;

        updateMatrix();
        updateWindowDisplay();
        updateStats();
        updateExplanation();
      }

      // é‡ç½®
      function reset() {
        state = {
          left: 0,
          right: 0,
          step: 0,
          checked: new Set(),
          pruned: new Set(),
          data: 'abcabcbb',
          autoPlayInterval: null,
        };

        document.getElementById('leftPointer').textContent = '0';
        document.getElementById('rightPointer').textContent = '0';
        document.getElementById('stepCount').textContent = '0';

        initMatrix();
        updateWindowDisplay();
        updateExplanation();
      }

      // è‡ªåŠ¨æ’­æ”¾
      function autoPlay() {
        if (state.autoPlayInterval) {
          clearInterval(state.autoPlayInterval);
          state.autoPlayInterval = null;
          document.querySelector('.btn-secondary:last-child').textContent = 'è‡ªåŠ¨æ’­æ”¾ â¯';
          return;
        }

        document.querySelector('.btn-secondary:last-child').textContent = 'æš‚åœ â¸';
        state.autoPlayInterval = setInterval(() => {
          const n = state.data.length;
          if (state.right >= n) {
            clearInterval(state.autoPlayInterval);
            state.autoPlayInterval = null;
            document.querySelector('.btn-secondary:last-child').textContent = 'è‡ªåŠ¨æ’­æ”¾ â¯';
            return;
          }
          nextStep();
        }, 1000);
      }

      // åˆå§‹åŒ–
      initMatrix();
      updateWindowDisplay();
      updateExplanation();
    </script>
  </body>
</html>
